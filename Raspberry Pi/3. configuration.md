# Configurations
## 1. Enable I2C and SPI
### 1.1 `sudo raspi-config`
Check if these are enabled by `lsmod`. If I2C enabled, the terminal echoes an `i2c-bcm2835` device, else you can add it manually: `sudo nano /etc/modules` and append:

```bash
i2c-bcm2835
i2c-dev
```

If SPI enabled, the terminal echoes an `spi-bcm2835` device.

### [1.2 Enable Multiple SPI](https://www.raspberrypi.org/documentation/hardware/raspberrypi/spi/README.md)
SPI0 is disabled by default. To enable it, use `raspi-config`, or ensure the line `dtparam=spi=on` isn't commented out in `/boot/config.txt`. By default it uses 2 chip select lines, but this can be reduced to 1 using `dtoverlay=spi0-1cs`. `dtoverlay=spi0-2cs` also exists, and without any parameters it is equivalent to `dtparam=spi=on`.

To enable SPI1, you can use 1, 2 or 3 chip select lines, adding in each case:

```bash
dtoverlay=spi1-1cs  #1 chip select
dtoverlay=spi1-2cs  #2 chip select
dtoverlay=spi1-3cs  #3 chip select
```

to `/boot/config.txt` file. Similar overlays exist for SPI2, SPI3, SPI4, SPI5 and SPI6.

Reboot and check with `ls /dev/spidev`

## 2. Development Environment
### 2.1 Mirrors (optional)
You can switch to TUNA mirrors if you need faster download. However, not all packages are supported in this mirror source.

```bash
$ sudo nano /etc/apt/sources.list
# add in the file:
deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib rpi
deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib rpi

$ sudo /etc/apt/sources.list.d/raspi.list
# add in the file:
deb http://mirrors.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
```

### 2.2 Python Environment
#### 2.2.1 Python Packages
Anaconda does not have ARM versions, so we stick to pre-installed Python enviroment on RPi. 

Here's a thing for whether to use `sudo apt-get install` or `pip3 install` to get Python packages. We recommend using `sudo apt-get install` as  `apt-get` enables update notifications, other apt-installed packages that need those tools know they're installed, etc. And most importantly. when you install through apt you're usually restricted to the version of the version(s) of the package your distro supports. Also, there's a more user-friendly version: `apt`

> `apt-get` may be considered as lower-level and "back-end", and support other APT-based tools. apt is designed for end-users (human) and its output may be changed between versions.
> The `apt` command is meant to be pleasant for end users and does not need to be backward compatible like apt-get(8).

#### 2.2.2 `apt-get` Package List
```bash
python3-pip
python3-numpy
python3-pil
RPi.GPIO
python3-gpiozero
jupyter-notebook
git
```

#### 2.2.3 `pip3` Package List
```bash
smbus
spidev
```

## 3. [Wi-Fi Config using `wpa_supplicant`](https://cloud.tencent.com/developer/article/1379709?from=information.detail.linux%20%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5wifi)

### 3.0 Vurrent Connection
```bash
$ iw dev
phy#0
        Unnamed/non-netdev interface
                wdev 0x2
                addr 22:67:d4:2d:ca:d3
                type P2P-device
                txpower 31.00 dBm
        Interface wlan0# Wi-Fi card name
                ifindex 2
                wdev 0x1
                addr b8:27:eb:55:5d:e1
                ssid Tenda_4334F0# Current Connection
                type managed
                channel 8 (2447 MHz), width: 20 MHz, center1: 2447 MHz
                txpower 31.00 dBm
```

### 3.1 扫描热点
```bash
$ wpa_cli -i <wlan0> scan_result

```

### 3.2 连接热点
```bash
wpa_cli -i wlan0 add_network // 添加一个网络连接,并返回网络ID号,如果wpa_supplicant.conf文件为空,则返回0,表示第一个热点,然后该ID号会在连接热点用到
```

#### 3.2.1以连接HibyMusic_5G-1为例
```bash
wpa_cli -i wlan0 set_network 0 ssid '"HiByMusic_5G-1"'    //设置ID为0的热点SSID
wpa_cli -i wlan0 set_network 0 psk '"hibymusic1109"'    //设置ID为0的热点的密码
```

PS:如果是没有加密的公共网络,则输入以下密码:

```bash
wpa_cli -i wlan0 set_network 0 key_mgmt NONE
```

继续输入:

```bash
wpa_cli -i wlan0 set_network 0 priority 2     //设置当前网络优先级,默认为2
wpa_cli -i wlan0 set_network 0 scan_ssid 1    //设置ssid默认为1即可
wpa_cli -i wlan0 enable_network 0            //启动连接ID为0的网络
wpa_cli -i wlan0 select_network 0             //选择网络0(这样做的好处在于,可以取消先前的其它网络连接)
udhcpc -b -i wlan0 -q    此时只是连接上,所以还要自动分配IP地址,-b:后台(back) –i:指定接口 –q:获得续约后退出
``` 

#### 3.2.2 保存连接的配置
```bash
wpa_cli -i wlan0 save_config    //保存当前连接的网络配置到wpa_supplicant.conf文件中,使得下次自动连接
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEzOTk0Mzc4MzksMjczNjY2MjgxLC0xMj
E0NDA5NTg3LDEyMDA1NDM5MjEsLTE4NjY5MzEyMTMsLTE5MzQy
MzMwMTMsLTUzNDQ2NzgwMCw3NTk5MDA0NDAsMTk1OTI5NDcxNy
wzNzAwMTg4OSwyMTA2NDAwMTMsLTE1MjUyMDg0MTcsMTYxNDUw
NjYyOSwtMjM2MDczNTUwLC0xNjMwMDcwMjIsMTgwOTM0MDgyOC
wxOTgyMjA0MTAxLDE1OTgzNjEyNDEsMTU5NzAxNTcyNiwxMTg3
ODk5MDAyXX0=
-->