# Configurations
## 1. Enable I2C and SPI
### 1.1 `sudo raspi-config`
Check if these are enabled by `lsmod`. If I2C enabled, the terminal echoes an `i2c-bcm2835` device, else you can add it manually: `sudo nano /etc/modules` and append:

```bash
i2c-bcm2835
i2c-dev
```

If SPI enabled, the terminal echoes an `spi-bcm2835` device.

### [1.2 Enable Multiple SPI](https://www.raspberrypi.org/documentation/hardware/raspberrypi/spi/README.md)
SPI0 is disabled by default. To enable it, use `raspi-config`, or ensure the line `dtparam=spi=on` isn't commented out in `/boot/config.txt`. By default it uses 2 chip select lines, but this can be reduced to 1 using `dtoverlay=spi0-1cs`. `dtoverlay=spi0-2cs` also exists, and without any parameters it is equivalent to `dtparam=spi=on`.

To enable SPI1, you can use 1, 2 or 3 chip select lines, adding in each case:

```bash
$ sudo nano /boot/config.txt
# add
dtoverlay=spi1-1cs  #1 chip select
dtoverlay=spi1-2cs  #2 chip select
dtoverlay=spi1-3cs  #3 chip select
```

Similar overlays exist for SPI2, SPI3, SPI4, SPI5 and SPI6.

Reboot and check with `ls /dev/`

## 2. Development Environment
### 2.1 Mirrors (optional)
You can switch to TUNA mirrors if you need faster download. However, not all packages are supported in this mirror source.

```bash
$ sudo nano /etc/apt/sources.list
# add
deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib rpi
deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main non-free contrib rpi
```
```bash
$ sudo /etc/apt/sources.list.d/raspi.list
# add
deb http://mirrors.tuna.tsinghua.edu.cn/raspberrypi/ buster main ui
```

### 2.2 Python Environment
#### 2.2.1 Python Packages
Anaconda does not have ARM versions, so we stick to pre-installed Python enviroment on RPi. 

Here's a thing for whether to use `sudo apt-get install` or `pip3 install` to get Python packages. We recommend using `sudo apt-get install` as  `apt-get` enables update notifications, other apt-installed packages that need those tools know they're installed, etc. And most importantly. when you install through apt you're usually restricted to the version of the version(s) of the package your distro supports. Also, there's a more user-friendly version: `apt`

> `apt-get` may be considered as lower-level and "back-end", and support other APT-based tools. apt is designed for end-users (human) and its output may be changed between versions.
> The `apt` command is meant to be pleasant for end users and does not need to be backward compatible like apt-get(8).

First run `sudo apt-get update` before installing anything

#### 2.2.2 `apt-get` Package List
```bash
python3-pip
python3-numpy
python3-pil
RPi.GPIO
python3-gpiozero
jupyter-notebook
git
```

#### 2.2.3 `pip3` Package List
```bash
smbus
spidev
```

## 3. [Wi-Fi Config using `wpa_supplicant`](https://cloud.tencent.com/developer/article/1379709?from=information.detail.linux%20%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5wifi)

### 3.0 Current Connection
```bash
$ iw dev
phy#0
        Unnamed/non-netdev interface
                wdev 0x2
                addr 22:67:d4:2d:ca:d3
                type P2P-device
                txpower 31.00 dBm
        Interface wlan0# Wi-Fi card name
                ifindex 2
                wdev 0x1
                addr b8:27:eb:55:5d:e1
                ssid Tenda_4334F0# Current Connection
                type managed
                channel 8 (2447 MHz), width: 20 MHz, center1: 2447 MHz
                txpower 31.00 dBm
```

### 3.1 Scan Networks
```bash
$ wpa_cli -i wlan0 scan
OK
$ wpa_cli -i wlan0 scan_result
c8:3a:35:43:34:f0       2447    -31     [WPA-PSK-CCMP][ESS]     Tenda_4334F0
18:69:da:81:5a:f8       2422    -59     [WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][ESS]    CMCC-E2DT
ec:26:ca:7a:58:04       2437    -61     [WPA-PSK-CCMP][WPA2-PSK-CCMP][ESS]      TP-LINK_2429
6c:16:32:c2:9c:08       2462    -64     [WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][WPS][ESS]       lnunicom_7Zjn
00:66:19:f3:5f:71       2412    -70     [WPA2-PSK-CCMP][WPS][ESS]
00:66:19:f3:5f:70       2412    -71     [WPA-PSK-CCMP][WPA2-PSK-CCMP][WPS][ESS] ChinaUnicom-33333
00:66:19:f3:5f:75       2412    -71     [WPA2-PSK-CCMP][WPS][ESS]
c8:c2:fa:17:47:7c       2437    -86     [WPA2-PSK-CCMP][WPS][ESS]       HUAWEI-FFZ389
ba:80:35:4c:f0:db       2462    -87     [WPA2-PSK-CCMP][ESS]
ba:80:35:4c:72:7e       2462    -90     [WPA2-PSK-CCMP][ESS]
7c:03:c9:32:9c:9a       2452    -91     [WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][WPS][ESS]       ChinaNet-3F4z
```

### 3.2 Add Networks
```bash
$ wpa_cli -i wlan0 add_network #添加一个网络连接,并返回网络ID号
0
$ wpa_cli -i wlan0 set_network 0 ssid '"SSID"'
OK
$ wpa_cli -i wlan0 set_network 0 psk '"password"' # $ wpa_cli -i wlan0 set_network 0 key_mgmt NONE; if no password is needed
OK
$ wpa_cli -i wlan0 set_network 0 priority 2
OK
$ wpa_cli -i wlan0 set_network 0 scan_ssid 1
OK
``` 

### 3.3 Connect Networks
```bash
$ wpa_cli -i wlan0 enable_network 0
$ wpa_cli -i wlan0 select_network 0 # cancel previous connection
$ udhcpc -b -i wlan0 -q # distribute IP address automatically -b:back –i:specify interface –q:quit
```

### 3.4 Save Networks
```bash
$ wpa_cli -i wlan0 save_config #save current config to wpa_supplicant.conf
$ sudo nano /etc/wpa_supplicant/wpa_supplicant.conf # directly modify the file
```

### 3.3 Monitor Networks
```bash
$ wpa_cli -i wlan0 status
bssid=c8:3a:35:43:34:f0
freq=2447
ssid=Tenda_4334F0
id=1
mode=station
pairwise_cipher=CCMP
group_cipher=CCMP
key_mgmt=WPA-PSK
wpa_state=COMPLETED
ip_address=192.168.0.100
p2p_device_address=52:e6:89:83:d5:4d
address=b8:27:eb:55:5d:e1
uuid=d0b9ba58-70bc-5d7d-b62f-1becbe057303
```
```bash
$ wpa_cli -i wlan0 list_network
network id / ssid / bssid / flags
0       ITSHUAWEIP9     any
1       Tenda_4334F0    any     [CURRENT]
```

### 3.4 Disable and Remove Networks
```bash
$ wpa_cli -i wlan0 disable_network 0
OK
$ wpa_cli -i wlan0 remove_network 0 #disable first
OK
$ wpa_cli -i wlan0 save_config
OK
```

## 4. Audio Config
### 4.0 Introduction
ALSA (Advanced Linux Sound Architecture) 是一个承载树莓派上音频系统的底层框架，为树莓派及其外接的播放或录制设备提供内核驱动程序。同时该框架也包含用于制作音频应用的程序代码，和一些方便的命令行实用程序。

### 4.1 Find Audio Device
```bash
$ lsusb #list usb device (for usb sound card)
Bus 001 Device 003: ID 0c76:161f JMTek, LLC.
```

```bash
$ cat /proc/asound/cards #check sound cards

1 [Device         ]: USB-Audio - USB PnP Audio Device
                     USB PnP Audio Device at usb-0000:01:00.0-1.3, full speed
```

```bash
$ sudo aplay -l #check playable device
# suppose we use card number 1 and device number 0
```

### 4.2 Switch Audio Device
Modify `/etc/asound.conf` or `~/.asoundrc`

```bash
$ sudo nano ~/.asoundrc # for example
# add
defaults.ctl.card 1 
defaults.pcm.card 1
defaults.pcm.device 0
```

### 4. Adjust Volume
```bash
alsamixer
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTk4NTIyOTExMSwtMjk3ODI1NzM3LDE0MD
U5NTgyNTQsLTgwNjIyODMyMywtOTI3OTU2Nzg1LDE3MTAzNTE0
OTMsLTg0OTcyMjUxMCwyNzM2NjYyODEsLTEyMTQ0MDk1ODcsMT
IwMDU0MzkyMSwtMTg2NjkzMTIxMywtMTkzNDIzMzAxMywtNTM0
NDY3ODAwLDc1OTkwMDQ0MCwxOTU5Mjk0NzE3LDM3MDAxODg5LD
IxMDY0MDAxMywtMTUyNTIwODQxNywxNjE0NTA2NjI5LC0yMzYw
NzM1NTBdfQ==
-->